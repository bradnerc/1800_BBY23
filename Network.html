<!DOCTYPE html>

<head>
  <meta charset="utf-8" />
  <title>Friends</title>
  <meta name="comp1800 boilerplate code" content="my bcit project" />
  <meta name="author" content="BCIT" />

  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />

  <!-- Google Icons (Material Design)-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

  <!-- Firebase 8 CDNs-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
  </script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>


  <!-- Link to the api keys for your firebase project -->
  <script src="./scripts/firebaseAPI_TEAM23.js"></script>

  <!-- JQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <style>
    .container {
      padding-top: 10%;
    }

    #profile_icon {
      position: absolute;
      font-size: 60px;
      margin-top: 10%;
      right: 5%;
      color: black;
      text-decoration: none;
    }

    #friends {
      display: grid;
      margin-top: 10%;
      margin-bottom: 10%;
      /* grid-template-columns: 20% 40% 20% 20%; */
    }

    .friend_request {
      display: grid;
      grid-template-columns: 20% 40% 20% 20%;
    }

    #invite {
      display: grid;
      margin-bottom: 10%;
    }

    .request {
      display: grid;
      grid-template-columns: 20% 80%;
    }
  </style>

</head>

<body>

  <div class="container">
    <header class="navbar justify-content-between bg-white fixed-top">
      <a class="material-icons" id="profile_icon" href="userprofile.html">account_circle</a>
    </header>
    <section class="heading">
      <h3>My Friends <span id="lol" class="badge bg-secondary">0</span></h3>
    </section>
    <section class="content">
      <br>
      <div class="input-group flex-nowrap">
        <div class="input-group-prepend">
          <span class="input-group-text" id="addon-wrapping"><span class="material-icons" id="search">
              search
            </span></span>
        </div>
        <input type="text" class="form-control" id="search-field" placeholder="Search Users" aria-label="Search Users"
          aria-describedby="addon-wrapping">
      </div>
      <ul class="list-group" id="search-list"></ul>
      <br>
      <br>
      <ul class="list-group list-group-flush">
        <li class="list-group-item"><span class="material-icons">account_circle</span> &nbsp; &nbsp;Friend 1</li>
        <li class="list-group-item"><span class="material-icons">account_circle</span> &nbsp; &nbsp;Friend 2</li>
        <li class="list-group-item"><span class="material-icons">account_circle</span> &nbsp; &nbsp;Friend 3</li>
        <li class="list-group-item"><span class="material-icons">account_circle</span> &nbsp; &nbsp;Friend 4</li>
        <li class="list-group-item"><span class="material-icons">account_circle</span> &nbsp; &nbsp;Friend 5</li>
      </ul>
    </section>
  </div>

  <figure class="text-center">
    <h1 class="card-title">Friends</h1>
  </figure>

  <h2>Incoming Friend Requests</h2>

  <div id="friends">
    <div class="friend_request">
      <span class="material-icons">account_circle</span>
      <h4>Euler</h4>
      <span class="material-icons">done</span>
      <span class="material-icons">close</span>
    </div>
    <div class="friend_request">
      <span class="material-icons">account_circle</span>
      <h4>Bernoulli</h4>
      <span class="material-icons">done</span>
      <span class="material-icons">close</span>
    </div>
    <div class="friend_request">
      <span class="material-icons">account_circle</span>
      <h4>Laplace</h4>
      <span class="material-icons">done</span>
      <span class="material-icons">close</span>
    </div>
    <div class="friend_request">
      <span class="material-icons">account_circle</span>
      <h4>Gauss</h4>
      <span class="material-icons">done</span>
      <span class="material-icons">close</span>
    </div>
  </div>

  <h2>Sent Friend Requests</h2>
  <div id="invite">
    <div class="request">
      <span class="material-icons">account_circle</span>
      <h4>John Smith</h4>
    </div>
    <div class="request">
      <span class="material-icons">account_circle</span>
      <h4>John Doe</h4>
    </div>
    <div class="request">
      <span class="material-icons">account_circle</span>
      <h4>Jane Doe</h4>
    </div>
  </div>

  <div id="footer"></div>

  <script>
    $.get("footer.html", {}, function (response) {
      $("div#footer").append(response);
    });
  </script>

<script>
  //placeholder
  const people = [{
      name: 'hoda'
  }, {
      name: 'hoda2'
  }, {
      name: 'hoda3'
  }, {
      name: 'hoda4'
  }, {
      name: 'hoda5'
  }, ];

  function getUsers() {

      firebase.auth().onAuthStateChanged((user) => {

          people.length = 0;
          console.log(people);

          var thisUser = firebase.auth().currentUser.uid;

          db.collection("users").get().then((data) => {
              data.forEach((moreData) => {
                  console.log(moreData.data().name);
                  // people.push({name: moreData.data().name});
                  // people.push({id: moreData.id});
                  people.push({
                      name: moreData.data().name,
                      id: moreData.id
                  });
                  console.log(people);
              })
          })
          console.log(people);
      })
  }

  getUsers();

  const searchList = document.getElementById('search-list');

  function setList(userList) {
      clearList();
      for (const person of userList) {
          const item = document.createElement('li');
          item.classList.add('list-group-item');
          item.id = person.id;
          const text = document.createTextNode(person.name);
          item.addEventListener("click", function () {
              displayId(person.id)
          });
          item.appendChild(text);
          searchList.appendChild(item);
      }
      if (userList.length === 0) {
          setNoResults();
      }
  }

  function displayId(id) {
      document.getElementById("lol").innerHTML = id;
      window.location.href = "profile.html?" + id;
  }

  function clearList() {
      while (searchList.firstChild) {
          searchList.removeChild(searchList.firstChild);
      }
  }

  function setNoResults() {
      const item = document.createElement('li');
      item.classList.add('list-group-item');
      const text = document.createTextNode('No results');
      item.appendChild(text);
      searchList.appendChild(item);
  }

  console.log('search-field')

  function getRelevantResult(value, searchTerm) {
      if (value === searchTerm) {
          return 2;
      } else if (value.startsWith(searchTerm)) {
          return 1;
      } else if (value.includes(searchTerm)) {
          return 0;
      } else {
          return -1;
      }
  }

  const searchField = document.getElementById('search-field')

  searchField.addEventListener('keyup', (e) => {
      //console.log(e.target.value);
      let value = event.target.value;
      if (value && value.trim().length > 0) {
          value = value.trim().toLowerCase();
          setList(people.filter(person => {
              return person.name.includes(value);
          }).sort((personA, personB) => {
              return getRelevantResult(personB.name, value) - getRelevantResult(personA.name,
                  value)
          }));
      } else {
          clearList();
      }
  });

</script>

    <!--Gets the list of pending friend requests that the user has -->
    <script>
      function getPendingFriendRequests(){

        firebase.auth().onAuthStateChanged(function (user) {

          if(user) {
            var thisUser = firebase.auth().currentUser.uid;
            console.log(thisUser);

            db.collection("friends").doc(thisUser).collection("friends").get().then((data) => {
              if(data.size == 0){
                console.log("You don't have any friends. Sad.");
              } else {
                console.log("You do have friends");
              }
            })
          }
        })
      }
    </script>

    <!-- Gets the list of friend requests that the user has sent -->
    <script>
      function getSentFriendRequests(){

      }
    </script>

  <!-- Option 1: Bootstrap Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

</body>